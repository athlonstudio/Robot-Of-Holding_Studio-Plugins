const queryKeys=[{key:0,query:"figma"},{key:1,query:"clickup"},{key:2,query:"drive.google"},{key:3,query:"quip"},{key:4,query:"qualtrics"}],pageKeys={LANDING:"landing",ONBOARDING:"onboarding",SETTINGS:"settings",ERROR:"error"},storageKeys={NAME:"boh_name",LIST:"boh_list"},localDataKey={TITLE:"title",DESCRIPTION:"description"};let page=pageKeys.LANDING;const main=document.querySelector("#plugin_boh .main");let clickupListData,localData={title:document.title||window.location.href,description:""},testingStorage={list:{name:"Default",id:901701936084}};const passEvent=(a,b)=>new CustomEvent(a,{detail:b});function init(){window.dispatchEvent(passEvent("GET_FROM_STORAGE",storageKeys.LIST)),window.dispatchEvent(passEvent("GET_FROM_STORAGE",storageKeys.NAME))}function saveToStorage_BOH(a,b){window.dispatchEvent(passEvent("SAVE_TO_STORAGE",{[a]:JSON.stringify(b)}))}function getFromStorage_BOH(a){const b=document.querySelector("#plugin_boh").dataset[`get${a}`];try{JSON.parse(b)}catch(a){return b}return JSON.parse(b)}function handleClose_BOH(){document.getElementById("plugin_boh").remove()}function renderPage_BOH(a){switch(main.innerHTML="",main.classList.remove(page),main.classList.add(a),main.appendChild(document.querySelector(`#page_${a}`).content.cloneNode(!0)),loadIcons_BOH(),page=a,a){case pageKeys.LANDING:document.querySelector("#list_name").innerHTML=getFromStorage_BOH(storageKeys.LIST)&&getFromStorage_BOH(storageKeys.LIST).name||"Select a list...",document.querySelector("#page-link_title").value=localData.title,document.querySelector("#page-link_description").value=localData.description,document.querySelector("#page-link_image").src=document.querySelector("[rel*=\"icon\"]")&&document.querySelector("[rel*=\"icon\"]").href||"https://placehold.co/60x60",handleTaskInput_BOH(document.querySelector("#page-link_title"),localDataKey.TITLE),handleTaskInput_BOH(document.querySelector("#page-link_description"),localDataKey.DESCRIPTION),document.querySelector(".list_selector").addEventListener("click",a=>openList_BOH(a)),document.querySelector(".button_close").addEventListener("click",handleClose_BOH),document.querySelector("#button_save").addEventListener("click",a=>handleCreateTask_BOH(a)),document.querySelector("#button_settings").addEventListener("click",()=>renderPage_BOH(pageKeys.SETTINGS));break;case pageKeys.SETTINGS:document.querySelector("#button_back").addEventListener("click",()=>renderPage_BOH(pageKeys.LANDING)),document.querySelector(".button_close").addEventListener("click",handleClose_BOH),handleNameInput_BOH();break;case pageKeys.ONBOARDING:case pageKeys.ERROR:default:}}function loadIcons_BOH(){const a=[...main.querySelectorAll("[data-load]")];a.forEach(a=>a.appendChild(document.querySelector(`#icon_${a.dataset.load}`).content.cloneNode(!0)))}function renderListRow_BOH(a,{name:b,id:c},d){a.appendChild(document.querySelector("#component_list-row").content.cloneNode(!0)),a.children[d].innerHTML=b,a.children[d].addEventListener("click",a=>setList_BOH(a)),a.children[d].setAttribute("value",c),getFromStorage_BOH(storageKeys.LIST)&&c==getFromStorage_BOH(storageKeys.LIST).id&&a.children[d].classList.add("selected-list")}async function openList_BOH(a){a.stopImmediatePropagation(),a.preventDefault();const b=a.currentTarget,c=document.querySelector("#clickup-list");clickupListData||(await getLists_BOH().then(a=>clickupListData=a.lists)),0===c.children.length&&clickupListData.forEach((a,b)=>renderListRow_BOH(c,a,b)),b.dataset.open="true"===b.dataset.open?"false":"true",c.classList.toggle("hide")}function setList_BOH(a){a.stopImmediatePropagation(),a.preventDefault();const b=a.currentTarget;saveToStorage_BOH(storageKeys.LIST,{name:b.innerHTML,id:b.getAttribute("value")}),document.querySelector(".selected-list")&&document.querySelector(".selected-list").classList.toggle("selected-list"),b.classList.add("selected-list"),document.querySelector("#list_name").innerHTML=getFromStorage_BOH(storageKeys.LIST).name}async function handleCreateTask_BOH(a){a.stopImmediatePropagation(),a.preventDefault();const b=a.currentTarget,c=window.location.href,d=queryKeys.filter(a=>c.includes(a.query))[0],e=getFromStorage_BOH(storageKeys.LIST)&&getFromStorage_BOH(storageKeys.LIST).id,f=getFromStorage_BOH(storageKeys.NAME);let g=!1;const h={name:localData[localDataKey.TITLE],description:localData[localDataKey.DESCRIPTION],url:c};b.classList.add("button-completed"),b.disabled=!0,b.innerHTML="Saved",setTimeout(()=>document.querySelector("#plugin_boh").style.display="none",2e3),await getTasks_BOH(e).then(a=>{g=!!a.tasks.find(a=>a.custom_fields[2].value===c)}),g||(await createTask_BOH(f,e,d,h)),document.querySelector("#plugin_boh").remove()}function handleSaveDebounce_BOH(a,b,c=()=>{},d=()=>{}){b||(b=!0,c(),setTimeout(()=>{a(),d(),b=!1},600))}function handleNameInput_BOH(){const a=document.querySelector("#input_name"),b=()=>{document.querySelector("#text_save").innerHTML="Saving\u2026",document.querySelector("#button_back").disabled=!0},c=()=>{document.querySelector("#button_back").disabled=!1,document.querySelector("#text_save").innerHTML="Saved."};a.value=getFromStorage_BOH(storageKeys.NAME)||"",a.addEventListener("keydown",a=>handleSaveDebounce_BOH(()=>saveToStorage_BOH(storageKeys.NAME,a.target.value),!1,b,c))}function handleTaskInput_BOH(a,b){a.value=localData[b],a.addEventListener("keydown",a=>handleSaveDebounce_BOH(()=>localData[b]=a.target.value,!1))}window.trustedTypes&&window.trustedTypes.createPolicy&&!window.trustedTypes.defaultPolicy?(window.trustedTypes.createPolicy("default",{createHTML:a=>a,createScriptURL:a=>a,createScript:a=>a}),init(),setTimeout(()=>{renderPage_BOH(pageKeys.LANDING),document.querySelector("#plugin_boh .main").style.cssText=`
            translate: 0;
            opacity: 1;
            visibility: visible;
        `},400),setTimeout(()=>{document.querySelector("#plugin_boh").style.overflow="visible"},600)):(init(),setTimeout(()=>{renderPage_BOH(pageKeys.ERROR),document.querySelector("#plugin_boh .main").style.cssText=`
            translate: 0;
            opacity: 1;
            visibility: visible;
        `},400),setTimeout(()=>{document.querySelector("#plugin_boh").remove()},2e3));